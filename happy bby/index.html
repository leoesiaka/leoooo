<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<title>Happy Birthday ‚Äî My Love ‚ù§Ô∏è</title>
<style>.signature {
  position: fixed;
  bottom: 10px;
  right: 15px;
  font-family: 'Dancing Script', 'Segoe Script', cursive;
  font-size: 22px;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.85);
  text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6);
  letter-spacing: 0.5px;
  pointer-events: none;
}

#love-notes-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
}

.love-note {
  position: absolute;
  font-family: 'Dancing Script', cursive;
  font-size: 20px;
  font-weight: 600;
  color: rgba(255, 192, 203, 0.85);
  text-shadow: 1px 1px 4px rgba(255, 105, 180, 0.6);
  animation: floatUp 5s ease-in forwards;
}

@keyframes floatUp {
  0% {
    transform: translateY(0);
    opacity: 0;
  }
  20% {
    opacity: 1;
  }
  100% {
    transform: translateY(-100px);
    opacity: 0;
  }
}
/* Love Letter Overlay */
#loveLetterOverlay {
  display: none; /* Hidden by default */
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(5px);
  z-index: 9999;
  justify-content: center;
  align-items: center;
}

.love-letter {
  background: rgba(255, 255, 255, 0.95);
  padding: 30px;
  max-width: 500px;
  border-radius: 15px;
  box-shadow: 0 0 25px rgba(255, 105, 180, 0.6);
  text-align: center;
  font-family: 'Dancing Script', cursive, sans-serif;
  animation: fadeIn 0.6s ease-in-out;
  position: relative;
}

.love-letter h2 {
  color: #ff3b6c;
  margin-bottom: 15px;
}

.love-letter p {
  font-size: 20px;
  line-height: 1.6;
  color: #444;
}

#closeLetter {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 26px;
  color: #ff3b6c;
  cursor: pointer;
  transition: 0.3s;
}

#closeLetter:hover {
  transform: scale(1.2);
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}


:root{
  --bg1:#120012; --bg2:#2b0018; --accent:#ff3b6b; --soft:#ffd6e0;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family: 'Segoe UI', system-ui, -apple-system, 'Helvetica Neue', Arial; background:radial-gradient(circle at 20% 10%, rgba(255,40,100,0.06), transparent 8%), linear-gradient(180deg,var(--bg1),var(--bg2)); color:#fff; overflow:hidden}
canvas#main{display:block;width:100%;height:100vh}
#ui{position:fixed;left:20px;top:18px;z-index:40;display:flex;gap:8px;align-items:center}
.btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);padding:10px 14px;border-radius:12px;color:white;backdrop-filter:blur(6px);cursor:pointer}
#audioBtn.playing{background:linear-gradient(90deg,var(--accent),#ff9fb6)}
#hint{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);color:var(--soft);opacity:0.95;padding:8px 14px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.03),transparent);font-weight:600}
#messageWrap{position:fixed;top:48%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:30;pointer-events:none}
#message{font-size:3.2rem;color:var(--accent);font-weight:800;letter-spacing:1px;text-shadow:0 0 20px rgba(255,60,100,0.9),0 0 40px rgba(255,150,170,0.6);opacity:0;transform-origin:center center}
#birthday{font-size:1.4rem;color:#ffdce6;margin-top:8px;opacity:0}
.note{position:fixed;right:20px;top:18px;color:#ffccd9;opacity:0.9;font-size:0.95rem}
/* Background floating heart badges */
.bg-heart{position:fixed;z-index:5;pointer-events:none;font-size:20px;opacity:0.2;text-shadow:0 0 12px rgba(255,100,130,0.06)}
/* sparkle styles ‚Äî small DOM sparkles used for layering */
.sparkle-dot{position:absolute;width:6px;height:6px;border-radius:50%;background:linear-gradient(180deg,#fff,#ffd7e5);box-shadow:0 0 10px rgba(255,200,230,0.9);pointer-events:none}
/* small responsiveness */
@media (max-width:520px){#message{font-size:2.2rem}#birthday{font-size:1.1rem}}


@media (min-width: 321px) and (max-width: 540px) {
  /* Main Love Message */
  #message {
    font-size: 2rem; /* smaller than desktop */
    letter-spacing: 0.5px;
  }
  #birthday {
    font-size: 1rem;
    line-height: 1.3;
  }

  /* Buttons UI */
  #ui {
    flex-wrap: wrap;
    gap: 6px;
    left: 10px;
    top: 10px;
  }
  .btn {
    padding: 8px 10px;
    font-size: 0.85rem;
    border-radius: 8px;
  }

  /* Love letter overlay */
  .love-letter {
    padding: 20px;
    max-width: 90%;
    font-size: 0.95rem;
  }
  .love-letter h2 {
    font-size: 1.3rem;
    margin-bottom: 10px;
  }
  .love-letter p {
    font-size: 1rem;
    line-height: 1.4;
  }
  #closeLetter {
    font-size: 22px;
    top: 8px;
    right: 10px;
  }

  /* Floating hearts smaller */
  .bg-heart {
    font-size: 14px !important;
  }
  .sparkle-dot {
    width: 4px;
    height: 4px;
  }

  /* Signature smaller */
  .signature {
    font-size: 16px;
    right: 10px;
    bottom: 8px;
  }

  /* Hint text */
  #hint {
    font-size: 0.85rem;
    padding: 6px 10px;
  }
}
@media (min-width: 550px) and (max-width: 1025px) {
  /* Main Love Message */
  #message {
    font-size: 2.8rem; /* slightly smaller than desktop */
    letter-spacing: 1px;
  }
  #birthday {
    font-size: 1.3rem;
    line-height: 1.4;
  }

  /* Buttons UI */
  #ui {
    flex-wrap: nowrap;
    gap: 10px;
    left: 20px;
    top: 15px;
  }
  .btn {
    padding: 10px 14px;
    font-size: 1rem;
    border-radius: 10px;
  }

  /* Love letter overlay */
  .love-letter {
    padding: 28px;
    max-width: 80%;
    font-size: 1.05rem;
  }
  .love-letter h2 {
    font-size: 1.6rem;
    margin-bottom: 12px;
  }
  .love-letter p {
    font-size: 1.1rem;
    line-height: 1.5;
  }
  #closeLetter {
    font-size: 26px;
    top: 10px;
    right: 12px;
  }

  /* Floating hearts a bit larger than mobile */
  .bg-heart {
    font-size: 20px !important;
  }
  .sparkle-dot {
    width: 5px;
    height: 5px;
  }

  /* Signature */
  .signature {
    font-size: 18px;
    right: 15px;
    bottom: 10px;
  }

  /* Hint text */
  #hint {
    font-size: 0.95rem;
    padding: 7px 12px;
  }
}

</style>
</head>
<body>
<canvas id="main"></canvas>
<div id="ui">
  <button id="audioBtn" class="btn">üéµ Play Music</button>
  <button id="toggleParticles" class="btn">‚ú® Toggle Effects</button>
  <button id="downloadBtn" class="btn">üì∑ Save Image</button>
  <button id="openMessageBtn" class="btn">üíå Open Message</button>
</div>

<!-- Love Letter Overlay -->
<div id="loveLetterOverlay">
  <div class="love-letter">
    <span id="closeLetter">&times;</span>
    <h2>To My Love ‚ù§Ô∏è</h2>
    <p>
      My dearest,<br><br>
      Every heartbeat of mine whispers your name.<br>
      You are the reason my mornings are brighter,<br>
      my nights are warmer,<br>
      and my life is more beautiful than I ever dreamed.<br><br>
      I promise to love you in every moment,<br>
      in every breath, in every tomorrow.<br><br>
      Forever yours,<br>
      Alvin üíñ
    </p>
  </div>
</div>


<div id="messageWrap">
  <div id="message">I LOVE YOU ‚ù§Ô∏è</div>
  <div id="birthday">Happy Birthday, My Beautiful Wife üéÇüíñ</div>
</div>
<div class="signature">Yours ‚ù§Ô∏è Alvin, your husband</div>
<div id="love-notes-container"></div>

<div id="hint">Tap the big heart ‚ù§Ô∏è</div>
<!-- optional audio (local file or user can replace) -->
<audio id="bgMusic" crossorigin="anonymous" preload="auto" loop>
  <source src="Lana Del Rey - Young and Beautiful [o_1aF54DO60].mp3" type="audio/mpeg">
</audio>

<!-- ‚úÖ ADDED for full-page screenshot -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
const canvas = document.getElementById('main');
const ctx = canvas.getContext('2d', { alpha: true });
let W = innerWidth, H = innerHeight;
function resize(){ W = canvas.width = innerWidth; H = canvas.height = innerHeight }
addEventListener('resize', resize); resize();

// Controls
const audioBtn = document.getElementById('audioBtn');
const bgMusic = document.getElementById('bgMusic');
const toggleParticlesBtn = document.getElementById('toggleParticles');
const downloadBtn = document.getElementById('downloadBtn');
let effectsOn = true;

// state
let particles = [];
const MAX_PARTICLES = 1200;
let forming = true;
let time = 0;
let heartbeat = 1;
let analyser=null, audioCtx=null, dataArray=null;

function makeHeartPoints(scale=1.0){
  const pts = [];
  for(let t=0;t<Math.PI*2; t+=0.009){
    const x = 16*Math.pow(Math.sin(t),3);
    const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
    pts.push({x: x*scale, y: -y*scale});
  }
  return pts;
}
const heartPoints = makeHeartPoints(18);

function initParticles(){
  particles = [];
  const centre = {x:W/2,y:H/2};
  for(let i=0;i<MAX_PARTICLES;i++){
    particles.push({
      x: Math.random()*W,
      y: Math.random()*H,
      vx: (Math.random()-0.5)*0.6,
      vy: (Math.random()-0.5)*0.6,
      size: (Math.random()*1.8)+0.6,
      hue: 330 + Math.random()*30,
      life: 1,
      targetIndex: i % heartPoints.length
    });
  }
}
initParticles();

function makeFloatingHearts(){
  for(let i=0;i<16;i++){
    const el = document.createElement('div');
    el.className='bg-heart';
    el.style.left = Math.random()*100 + '%';
    el.style.top = Math.random()*100 + '%';
    el.style.fontSize = (Math.random()*40+14) + 'px';
    el.style.opacity = 0.06 + Math.random()*0.18;
    el.textContent = '‚ù§Ô∏è';
    document.body.appendChild(el);
    el.animate([{transform:'translateY(0px)'},{transform:'translateY(-120px)'}],{duration:8000+Math.random()*8000,iterations:Infinity,direction:'alternate'});
  }
}
makeFloatingHearts();

function makeSparkles(){
  for(let i=0;i<28;i++){
    const s = document.createElement('div');
    s.className='sparkle-dot';
    s.style.left = (10 + Math.random()*80) + '%';
    s.style.top = (10 + Math.random()*80) + '%';
    s.style.opacity = 0.6*Math.random();
    s.style.transform = 'scale('+(0.5+Math.random()*1.8)+')';
    document.body.appendChild(s);
    s.animate([{opacity:0.1},{opacity:0.95},{opacity:0.1}],{duration:(2000+Math.random()*3000),iterations:Infinity,delay:Math.random()*2000});
  }
}
makeSparkles();

const lerp=(a,b,t)=>a+(b-a)*t;

function explode(x,y){
  for(let i=0;i<160;i++){
    const p = {
      x:x, y:y,
      vx:(Math.random()-0.5)*8,
      vy:(Math.random()-1.5)*8,
      size:1 + Math.random()*3,
      hue:300 + Math.random()*60,
      life:1,
      gravity:0.15
    };
    particles.push(p);
  }
  while(particles.length>MAX_PARTICLES) particles.shift();
}

function firework(x,y){
  for(let i=0;i<60;i++){
    const angle = Math.random()*Math.PI*2;
    const speed = 1 + Math.random()*5;
    particles.push({ x:x, y:y, vx:Math.cos(angle)*speed, vy:Math.sin(angle)*speed, size:1+Math.random()*2, hue:250+Math.random()*120, life:1, gravity:0.06 });
  }
}

function draw(){
  ctx.clearRect(0,0,W,H);
  time += 0.016;

  const grd = ctx.createLinearGradient(0,0,0,H);
  grd.addColorStop(0,'rgba(255,200,220,0.02)');
  grd.addColorStop(0.7,'rgba(0,0,0,0.25)');
  ctx.fillStyle = grd; ctx.fillRect(0,0,W,H);

  const cx = W/2, cy = H/2;

  let pulse = heartbeat;
  if(analyser){
    analyser.getByteTimeDomainData(dataArray);
    let sum = 0; for(let i=0;i<dataArray.length;i++){ const d = (dataArray[i]-128)/128; sum += d*d }
    const rms = Math.sqrt(sum / dataArray.length);
    pulse = 1 + Math.min(rms*6,0.8);
  }

  ctx.save();
  const glowRad = 120 + 40*Math.sin(time*2);
  const glow = ctx.createRadialGradient(cx,cy,0,cx,cy,glowRad);
  glow.addColorStop(0,'rgba(255,100,140,'+ (0.25 * pulse) +')');
  glow.addColorStop(0.6,'rgba(255,50,70,0.06)');
  glow.addColorStop(1,'rgba(0,0,0,0)');
  ctx.fillStyle = glow; ctx.beginPath(); ctx.arc(cx,cy,glowRad,0,Math.PI*2); ctx.fill();
  ctx.restore();

  if(forming){
    for(let i=0;i<Math.min(particles.length, MAX_PARTICLES); i++){
      const p = particles[i];
      const target = heartPoints[p.targetIndex];
      const tx = cx + target.x * (1.0 * pulse);
      const ty = cy + target.y * (1.0 * pulse);
      p.x = lerp(p.x, tx + (Math.random()-0.2)*6, 0.03);
      p.y = lerp(p.y, ty + (Math.random()-0.2)*6, 0.03);

      p.x += Math.sin(time*0.5 + i)*0.12;
      p.y += Math.cos(time*0.4 + i)*0.12;

      ctx.beginPath();
      const size = p.size * (0.9 + Math.sin(time*1.6 + i)*0.06 + pulse*0.08);
      ctx.fillStyle = `hsl(${p.hue},85% , 60%)`;
      ctx.globalAlpha = 0.92;
      ctx.arc(p.x, p.y, size, 0, Math.PI*2);
      ctx.fill();
      if(i%18===0){ ctx.globalAlpha=0.14; ctx.beginPath(); ctx.arc(p.x,p.y,size*6,0,Math.PI*2); ctx.fill(); }
    }
  } else {
    for(let i=0;i<particles.length;i++){
      const p = particles[i];
      p.vy = (p.vy||0) + (p.gravity||0) * 1.0;
      p.x += p.vx||0; p.y += p.vy||0;
      p.life -= 0.008;
      ctx.beginPath(); ctx.fillStyle = `hsl(${p.hue||320},85% , 60%)`; ctx.globalAlpha = Math.max(0, Math.min(1, p.life)); ctx.arc(p.x,p.y,p.size,0,Math.PI*2); ctx.fill();
      if(p.life>0 && Math.random()<0.04){ ctx.globalAlpha = 0.05; ctx.fillRect(p.x-1,p.y-1,2,2) }
    }
    particles = particles.filter(p=>p.life>0 && p.y < H+200);
  }

  ctx.globalAlpha = 0.12;
  ctx.beginPath(); ctx.strokeStyle='rgba(255,120,150,0.12)'; ctx.lineWidth=2; ctx.arc(cx,cy, 220 + Math.sin(time*0.6)*12, 0, Math.PI*2); ctx.stroke();
  ctx.globalAlpha = 1;

  requestAnimationFrame(draw);
}
requestAnimationFrame(draw);

canvas.addEventListener('pointerdown', (e)=>{
  if(forming){
    forming = false;
    const m = document.getElementById('message'); const b = document.getElementById('birthday');
    m.style.transition = 'transform 0.45s cubic-bezier(.2,.9,.2,1), opacity 0.45s';
    b.style.transition = 'opacity 1.2s 0.2s';
    m.style.opacity = 1; m.style.transform = 'scale(1.08)';
    b.style.opacity = 1;

    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left; const y = e.clientY - rect.top;
    explode(x,y); firework(x,y-60);

    setTimeout(()=>firework(W*0.3, H*0.25), 350);
    setTimeout(()=>firework(W*0.7, H*0.28), 700);
  } else {
    forming = true; initParticles();
    document.getElementById('message').style.opacity = 0; document.getElementById('message').style.transform='scale(1)';
    document.getElementById('birthday').style.opacity = 0;
  }
});

audioBtn.addEventListener('click', async ()=>{
  if(bgMusic.paused){
    try{
      await bgMusic.play();
    }catch(err){
      console.warn('play prevented', err);
    }
    audioBtn.classList.add('playing'); audioBtn.textContent='‚è∏ Pause Music';

    if(!audioCtx){
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const source = audioCtx.createMediaElementSource(bgMusic);
      analyser = audioCtx.createAnalyser(); analyser.fftSize = 512;
      source.connect(analyser); analyser.connect(audioCtx.destination);
      dataArray = new Uint8Array(analyser.fftSize);
    }
  } else {
    bgMusic.pause(); audioBtn.classList.remove('playing'); audioBtn.textContent='üéµ Play Music';
  }
});

toggleParticlesBtn.addEventListener('click', ()=>{ effectsOn = !effectsOn; toggleParticlesBtn.textContent = effectsOn? '‚ú® Toggle Effects' : '‚ú® Effects Off'; document.body.style.filter = effectsOn? 'none' : 'grayscale(0.18)'; });

// ‚úÖ UPDATED: Full-page capture instead of just canvas
downloadBtn.addEventListener('click', ()=>{
  html2canvas(document.body, {backgroundColor: null}).then(canvasCapture => {
    const link = document.createElement('a');
    link.download = 'happy-birthday-heart.png';
    link.href = canvasCapture.toDataURL('image/png');
    link.click();
  });
});

let running = true;
addEventListener('visibilitychange', ()=>{ running = !document.hidden; if(running) requestAnimationFrame(draw); })

setTimeout(()=>{
  const m=document.getElementById('message'); m.style.opacity = 1; m.style.transform = 'scale(1)';
  let s=0; setInterval(()=>{ s+=0.5; m.style.transform = 'scale('+(1 + 0.02*Math.sin(s))+')' }, 300);
}, 500);
</script>
<script>
const phrases = [
  "My Queen ‚ù§Ô∏è",
  "Forever Yours üíç",
  "My Sunshine ‚òÄÔ∏è",
  "Love of My Life üíñ",
  "Always & Forever üíû",
  "My Heartbeat üíì",
  "Sweetest Soul üåπ"
];

function createLoveNote() {
  const note = document.createElement("div");
  note.className = "love-note";
  note.textContent = phrases[Math.floor(Math.random() * phrases.length)];

  const startLeft = Math.random() * 80; // percentage position
  note.style.left = startLeft + "%";
  note.style.bottom = "0";

  document.getElementById("love-notes-container").appendChild(note);

  setTimeout(() => {
    note.remove();
  }, 5000);
}

// Create a new love note every 2 seconds
setInterval(createLoveNote, 2000);
</script>
<script>
    // Open message
document.getElementById("openMessageBtn").addEventListener("click", function() {
  document.getElementById("loveLetterOverlay").style.display = "flex";
});

// Close message
document.getElementById("closeLetter").addEventListener("click", function() {
  document.getElementById("loveLetterOverlay").style.display = "none";
});

// Close when clicking outside the letter
document.getElementById("loveLetterOverlay").addEventListener("click", function(e) {
  if (e.target.id === "loveLetterOverlay") {
    this.style.display = "none";
  }
});

</script>
</body>
</html>
